<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TimerCount and GetApi Data</title>
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.1/dist/sweetalert2.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="css/myStyle.css">
</head>
<body>
 
<!-- ❓ **題目敘述**

  請使用Vue2完成一個頁面，需求如下：

  1. 彈出一個popup window，呈現出從現在開始的倒數時間，截止日為2023-02-28 日期格式為dd HH:mm:ss
  2. [https://testnet.binancefuture.com/dapi/v1/premiumIndex](https://testnet.binancefuture.com/dapi/v1/premiumIndex) 請使用此API在頁面上秀出
      1. 交易對 Symbol：貨幣交易對，例如
      2. 標記價格 Mark Price
      3. 指數價格 Index Price
      4. 下次資金費率結算時間 Next Funding Time

**💡 可使用任意套件完成題目！** -->
<div class="container">
 
  <div id="app">
    <!-- <button @click="getApiData">拿資料</button> -->
     <h1>Coutdown my Date</h1>
     <p>今天日期為:{{nowDate.toLocaleDateString()}} </p>
     <p>截止日期為:{{finshedData.toLocaleDateString()}} </p>
     <div class="counter-view">
      <h6>Your</h6>
        <ul class="counter">
          <li class="days" data-content="Days">{{display.days}}</li>
          <li class="hours" data-content="Hours">{{display.hours}}</li>
          <li class="mins" data-content="Mins">{{display.mins}}</li>
          <li class="secs" data-content="Secs">{{display.secs}}</li>
        </ul>
     </div>
     <hr>
    <button type="button" class="btn" @click="getApiData">Get Data</button>

    <ul class="dataList">
        <li v-for="(item, index) in itemsCovert" :key="index" >
          {{ item.computedValue }}
        </li>
  </ul>
  </div>

</div>
  

  <!-- 這些專業名詞是與加密貨幣交易所相關的術語，通常被使用在加密貨幣的期貨交易市場中。以下是相對應的中文名詞解釋：

  Symbol：貨幣交易對，例如 BTC/USDT 或 ETH/BTC 等。
  Pair：同 Symbol，也是貨幣交易對。
  Mark Price：市價，是基於交易所掛單價格平均值計算出的指數價格。
  Index Price：指數價格，是市場上幾家主要交易所的加權平均價格。
  Estimated Settle Price：預估結算價格，是基於標的指數價格計算出的結算價格。
  Last Funding Rate：最後一次資金費率，是用於調整持倉的費率，由多空雙方之間互相支付。
  Interest Rate：利率，是指用於計算資金費率的基準利率。
  Next Funding Time：下一次資金費率結算時間，是多空雙方交換費率的時間。
  Time：時間，指交易或其他相關事件發生的時間。 -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>   
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.1/dist/sweetalert2.all.min.js"></script>
  <script src="https://unpkg.com/vue@2"></script>
  <script>
       
  </script>
  <script>
    const app = new Vue({
      el: '#app',
      data: {
        message: 'Hello Vue!',
        apiData:[],

        // 當前日期
        nowDate:new Date(),

        // 截止日期
        finshedData:new Date(2023,1,28,23,59,59,59),
        isGeted:false,
        // 計數器
        display:{
          days:0,
          hours:0,
          mins:0,
          secs:0
        }
      },
      methods: {
        getApiData(){
          _this = this;
          Swal.fire({
              title: 'Are you sure?',
              // title: 'Error!',
              text: 'Do you want to get ApiData?',
              icon: 'info',
              confirmButtonText: 'OK',
              confirmButtonColor: '#3085d6',
              
              showCancelButton: true,
              cancelButtonText:'Empty DataList',
              cancelButtonColor: '#d33',
            }).then((result) => {
                if (result.isConfirmed && !_this.isGeted) {
                  Swal.fire(
                    'Api DataList update',
                    'Please check your DataList.',
                    'success'
                  )
                  axios
                  .get('https://testnet.binancefuture.com/dapi/v1/premiumIndex')
                  .then(res =>{
                    // console.log(res.data)
                    _this.apiData = [];
                    res.data.forEach(el => {
                      _this.apiData.push(el);
                    });
                    console.log(this.apiData);
                    _this.isGeted = true;
                  })
                  .catch(function (error) { 
                    console.log(error);
                  });

                }else{
                   _this.apiData = [];
                    _this.isGeted = false;
                }
              })


         
        },
        showRemain(){
          // 啟動計時器
          const timer = setInterval(()=>{
          const now = new Date();
          const end = this.finshedData;

          const timeDiff = end.getTime() - now.getTime();
            
          if(timeDiff < 0){
            clearInterval(timer)
            return alert('timer over')
          }

          const days = Math.floor(timeDiff / this._days);
          const hours = Math.floor(timeDiff % this._days / this._hours);
          const mins = Math.floor(timeDiff % this._hours / this._mins);
          const secs = Math.floor(timeDiff % this._mins / this._secs);

          // DD HH:MM:SS 時間格式
          this.display.mins = mins < 10 ? "0" + mins :mins;
          this.display.secs = secs < 10 ? "0" + secs :secs;
          this.display.hours = hours < 10 ? "0" + hours :hours;
          this.display.days = days < 10 ? "0" + days :days;
          },800)
       
        },
       
      },
      mounted: function(){
        this.showRemain()
      },
      computed:{
        _secs:()=>1000,
        _mins(){
          return this._secs* 60;
        },
        _hours(){
          return this._mins * 60;
        },
        _days(){
          return this._hours * 24;
        },

        itemsCovert() {
          return this.apiData.map(item => {
          // console.log(item.nextFundingTime)
          console.log(item)
 
          // 1. 交易對 Symbol：貨幣交易對，例如
          const symbol = item.symbol;
          // 2. 標記價格 Mark Price
          const markPrice = item.markPrice;
          // 3. 指數價格 Index Price
          const indexPrice = item.indexPrice;
          
          // 4. 下次資金費率結算時間 Next Funding Time
          // const totalSeconds = Math.floor(item.time / 1000);
          const totalSeconds = Math.floor(item.nextFundingTime / 1000);
          const seconds = totalSeconds % 60;
          const totalMinutes = Math.floor(totalSeconds / 60);
          const minutes = totalMinutes % 60;
          const totalHours = Math.floor(totalMinutes / 60);
          const hours = totalHours % 24;
          const days = Math.floor(totalHours / 24);
          console.log(days)
            return {
              computedValue:`
              Symbol:${symbol},
              markPrice:${markPrice},
              indexPrice:${indexPrice},---
              ${days.toString().padStart(2, '0')}, 
              ${hours.toString().padStart(2, '0')}
              :${minutes.toString().padStart(2, '0')}
              :${seconds.toString().padStart(2, '0')}`,
            };
          });
         },
          
      }
    })
  </script>  
</body>
</html>